FROM node:20.2.0-alpine3.16 as build
COPY client  /
WORKDIR /client
RUN ls
RUN npm run build


FROM iqtlabs/edgetech-core:latest
WORKDIR /app
RUN mkdir static
COPY --from=build /build/* /app/static
COPY pyproject.toml .
COPY poetry.lock .
RUN pip3 install poetry==1.5.1
RUN poetry config virtualenvs.create false
RUN poetry install --no-dev
ADD occlusion_mapper.py .
ENTRYPOINT [ "python3", "occlusion_mapper.py" ]